/**
 * angular-route-segment v1.0.2
 * https://angular-route-segment.com
 * @author Artem Chivchalov
 * @license MIT License http://opensource.org/licenses/MIT
 */
"use strict";!function(a){a.module("route-segment",[]).provider("$routeSegment",["$routeProvider",function(b){function c(a){return a.replace(/([\:\-\_]+(.))/g,function(a,b,c,d){return d?c.toUpperCase():c})}function d(a,b){if(!a)throw new Error("Invalid pointer segment");var e;return{segment:function(b,d){return a[c(b)]={params:d},e=b,this},within:function(b){var g;if(b=b||e,g=a[c(b)])void 0==g.children&&(g.children={});else{if(f.strictMode)throw new Error("Cannot get into unknown `"+b+"` segment");g=a[c(b)]={params:{},children:{}}}return d(g.children,this)},up:function(){return b},root:function(){return h}}}var e=this,f=e.options={autoLoadTemplates:!1,strictMode:!1},g=this.segments={},h=d(g,null);e.when=function(a,c){return b.when(a,{segment:c}),this},a.extend(e,h),this.$get=["$rootScope","$q","$http","$templateCache","$route","$routeParams","$injector",function(b,d,e,h,i,j,k){function l(b){var c=!1;return b.params.dependencies&&a.forEach(b.params.dependencies,function(b){a.equals(q[b],j[b])||(c=!0)}),c}function m(a,c){return p.chain[a]&&p.chain[a].clearWatcher&&p.chain[a].clearWatcher(),c?c.params.untilResolved?n(a,c.name,c.params.untilResolved).then(function(){n(a,c.name,c.params)}):n(a,c.name,c.params):(b.$broadcast("routeSegmentChange",{index:a,segment:null}),void 0)}function n(c,g,i){var j=a.extend({},i.resolve);return a.forEach(j,function(b,c){j[c]=a.isString(b)?k.get(b):k.invoke(b)}),i.template&&(j.$template=i.template),f.autoLoadTemplates&&i.templateUrl&&(j.$template=e.get(i.templateUrl,{cache:h}).then(function(a){return a.data})),d.all(j).then(function(d){if(p.chain[c]={name:g,params:i,locals:d,reload:function(){m(c,this)}},i.watcher){var e=function(){if(!a.isFunction(i.watcher))throw new Error("Watcher is not a function in segment `"+g+"`");return k.invoke(i.watcher,{},{segment:p.chain[c]})},f=e();p.chain[c].clearWatcher=b.$watch(e,function(a){a!=f&&(f=a,p.chain[c].reload())})}b.$broadcast("routeSegmentChange",{index:c,segment:p.chain[c]})},function(b){if(!i.resolveFailed)throw new Error("Resolving failed with a reason `"+b+"`, but no `resolveFailed` "+"provided for segment `"+g+"`");var e={error:function(){return d.when(b)}};n(c,g,a.extend({resolve:e},i.resolveFailed))})}function o(a,b){if(!b)return null;if(a>=b.length)return null;for(var d,e=g,f=0;a>=f;f++)d=b[f],void 0!=e[c(d)]&&(e=e[c(d)]),a>f&&(e=e.children);return{name:d,params:e.params}}var p={name:"",chain:[],startsWith:function(a){var b=new RegExp("^"+a);return b.test(p.name)},contains:function(a){for(var b=0;b<this.chain.length;b++)if(this.chain[b].name==a)return!0;return!1}},q=a.copy(j);return b.$on("$routeChangeSuccess",function(b,c){var e=c.$route||c.$$route;if(e&&e.segment){for(var f=e.segment,g=f.split("."),h=[],i=0;i<g.length;i++){var k=o(i,g);(!p.chain[i]||p.chain[i].name!=k.name||l(k))&&h.push(m(i,k))}d.all(h).then(function(){if(p.name=f,p.chain.length>g.length){for(var a=g.length;a<p.chain.length;a++)m(a,null);p.chain.splice(-1,p.chain.length-g.length)}}),q=a.copy(j)}}),p}]}])}(angular),function(a){a.module("view-segment",["route-segment"]).directive("appViewSegment",["$route","$compile","$controller","$routeParams","$routeSegment","$q","$injector",function(b,c,d,e,f,g,h){return{restrict:"ECA",priority:500,compile:function(b,e){var f=b.html(),g=!0,i=a.element(document.createComment(" view-segment "));return b.prepend(i),function(j){function k(){n&&(o.leave(n),n=null),m&&(m.$destroy(),m=null)}function l(e){if(!e)return k(),n=b.clone(),n.html(f),o.enter(n,null,i),c(n,!1,499)(j),void 0;g&&(g=!1,b.replaceWith(i));var h=a.extend({},e.locals),l=h&&h.$template;if(l){k(),n=b.clone(),n.html(l),o.enter(n,null,i);var q,r=c(n,!1,499);m=j.$new(),e.params.controller&&(h.$scope=m,q=d(e.params.controller,h),n.data("$ngControllerController",q),n.children().data("$ngControllerController",q)),r(m),m.$emit("$viewContentLoaded"),m.$eval(p)}else k()}var m,n,o,p=e.onload||"",q=parseInt(e.appViewSegment);try{var r=h.get("$animator");o=r(j,e)}catch(s){}try{o=h.get("$animate")}catch(s){}j.$on("routeSegmentChange",function(a,b){b.index==q&&l(b.segment)})}}}}])}(angular);